<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForeScore</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Hamburger Menu Button (fixed to top) -->
    <button id="hamburgerBtn" class="hamburger-btn" aria-label="Open menu">
        <span>â˜°</span>
    </button>

    <!-- Sidebar Overlay (dark background when menu is open) -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>ğŸŒï¸ ForeScore</h2>
            <button id="closeSidebarBtn" class="close-sidebar-btn" aria-label="Close menu">âœ•</button>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" id="navScoreEntry" class="menu-item">â›³ Score Entry</a></li>
            <li><a href="#" id="navCourseHistory" class="menu-item">ğŸ“Š Course History</a></li>
            <li><a href="#" id="navPlayerStats" class="menu-item">ğŸ‘¤ Player Stats</a></li>
            <li><a href="#" id="navCloudSync" class="menu-item">â˜ï¸ Cloud Sync</a></li>
            <li><a href="#" id="navBackupRestore" class="menu-item">ğŸ’¾ Backup & Restore</a></li>
        </ul>

        <!-- Cloud Sync Status (at bottom of sidebar) -->
        <div class="sync-status-widget">
            <div id="syncStatusIndicator" class="sync-status-item">
                <span class="sync-icon">â³</span>
                <span class="sync-text">Initializing...</span>
            </div>
            <div id="lastSyncTime" class="last-sync-time">Never synced</div>
        </div>
    </nav>

    <!-- Storage Warning Banner -->
    <div id="storageWarningBanner" class="storage-warning-banner" style="display: none;">
        <!-- Warning content will be injected here -->
    </div>

    <!-- Main container for the entire app -->
    <div class="app-container">

        <!-- SCREEN 1: Setup New Round -->
        <div id="setupScreen" class="screen active">
            <h1>ğŸŒï¸ ForeScore</h1>

            <div class="setup-form">
                <div class="form-group">
                    <label for="courseName">Course Name</label>
                    <input type="text" id="courseName" placeholder="Enter course name" required>
                </div>

                <div class="form-group">
                    <label for="roundDate">Date</label>
                    <input type="date" id="roundDate" required>
                </div>

                <div class="form-group">
                    <label>Players</label>
                    <div id="playersList">
                        <input type="text" class="player-input" placeholder="Player 1" required>
                    </div>
                    <button type="button" class="btn-secondary" id="addPlayerBtn">+ Add Player</button>
                </div>

                <button class="btn-primary" id="startRoundBtn">Start Round</button>
            </div>
        </div>

        <!-- SCREEN 2: Score Entry -->
        <div id="scoreScreen" class="screen">
            <div class="score-header">
                <button class="btn-back" id="backBtn">â† Back</button>
                <div class="round-info">
                    <h2 id="courseNameDisplay"></h2>
                    <p id="roundDateDisplay"></p>
                </div>
            </div>

            <div class="hole-navigation">
                <button class="btn-nav" id="prevHoleBtn">â† Prev</button>
                <h2 id="currentHoleDisplay">Hole 1</h2>
                <button class="btn-nav" id="nextHoleBtn">Next â†’</button>
            </div>

            <div id="playersScoreContainer" class="players-score-container">
                <!-- Player score cards will be added here dynamically -->
            </div>

            <div class="action-buttons">
                <button class="btn-secondary" id="viewScoresBtn">View Scorecard</button>
            </div>
        </div>

        <!-- SCREEN 3: Scorecard View -->
        <div id="scorecardScreen" class="screen">
            <div class="score-header">
                <button class="btn-back" id="backToScoreBtn">â† Back to Scoring</button>
                <h2>Scorecard</h2>
            </div>

            <div id="scorecardContainer" class="scorecard-container">
                <!-- Scorecard table will be generated here -->
            </div>

            <div class="action-buttons">
                <button class="btn-primary" id="saveFinishBtn">Save & Finish Round</button>
            </div>
        </div>

        <!-- SCREEN 4: Course Search (Golf Course API) -->
        <div id="courseSearchScreen" class="screen">
            <h1>ForeScore</h1>

            <div class="form-group">
                <label for="courseSearchInput">Search for a golf course</label>
                <input type="text" id="courseSearchInput" placeholder="Enter course name or city">
                <button class="btn-primary" id="searchCoursesBtn">Search Courses</button>
            </div>

            <div id="searchResults" class="search-results">
                <!-- Search results will appear here -->
            </div>

            <div class="action-buttons">
                <button class="btn-secondary" id="manualCourseBtn">Enter Course Manually</button>
            </div>
        </div>

        <!-- SCREEN 5: Course History -->
        <div id="historyScreen" class="screen">
            <h1>ğŸ“Š Course History</h1>

            <div id="historyList" class="history-list">
                <!-- Past rounds will be listed here -->
            </div>

            <div class="action-buttons">
                <button class="btn-primary" id="startNewRoundBtn">Start New Round</button>
            </div>
        </div>

        <!-- SCREEN 6: Round Detail (viewing a past round) -->
        <div id="roundDetailScreen" class="screen">
            <div class="score-header">
                <button class="btn-back" id="backToHistoryBtn">â† Back to History</button>
                <h2 id="detailCourseName"></h2>
                <p id="detailRoundDate"></p>
            </div>

            <div id="detailScorecard" class="scorecard-container">
                <!-- Detailed scorecard will be shown here -->
            </div>
        </div>

        <!-- SCREEN 7: Player Statistics -->
        <div id="statsScreen" class="screen">
            <h1>ğŸ‘¤ Player Stats</h1>

            <div id="playerStatsList" class="player-stats-list">
                <!-- List of all players will appear here -->
            </div>
        </div>

        <!-- SCREEN 8: Individual Player Detail -->
        <div id="playerDetailScreen" class="screen">
            <div class="score-header">
                <button class="btn-back" id="backToStatsBtn">â† Back to Stats</button>
                <h2 id="playerDetailName"></h2>
            </div>

            <div id="playerDetailStats" class="player-detail-stats">
                <!-- Detailed player statistics will be shown here -->
            </div>
        </div>

        <!-- SCREEN 9: Backup & Restore -->
        <div id="backupRestoreScreen" class="screen">
            <h1>ğŸ’¾ Backup & Restore</h1>

            <!-- Storage Info Section -->
            <div class="storage-info-section">
                <h3>Storage Status</h3>
                <div id="storageInfoDisplay">
                    <!-- Storage info will be dynamically inserted here -->
                </div>
            </div>

            <!-- Export Section -->
            <div class="backup-section">
                <h3>Export Your Data</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 16px;">
                    Save your rounds as a backup file that you can restore later.
                </p>

                <button class="btn-primary" id="exportAllDataBtn" style="width: 100%; margin-bottom: 12px;">
                    ğŸ“¦ Export All Data
                </button>

                <button class="btn-secondary" id="exportLast30DaysBtn" style="width: 100%; margin-bottom: 12px;">
                    ğŸ“… Export Last 30 Days
                </button>

                <button class="btn-secondary" id="exportSelectedBtn" style="width: 100%; margin-bottom: 12px;">
                    ğŸ¯ Export Selected Date Range
                </button>

                <button class="btn-secondary" id="exportCsvBtn" style="width: 100%;">
                    ğŸ“Š Export to CSV
                </button>
            </div>

            <!-- Import Section -->
            <div class="restore-section">
                <h3>Import Data</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 16px;">
                    Restore rounds from a previously saved backup file.
                </p>

                <input type="file" id="importFileInput" accept=".json" style="display: none;">
                <button class="btn-primary" id="importDataBtn" style="width: 100%;">
                    ğŸ“¥ Import Backup File
                </button>

                <div id="importStatus" style="margin-top: 12px; font-size: 14px;">
                    <!-- Import status messages will appear here -->
                </div>
            </div>

            <!-- Instructions -->
            <div class="backup-instructions">
                <h4>ğŸ“± Mobile Instructions</h4>
                <p><strong>To Export:</strong> Tap Export, then choose "Save to Files" or "Save to iCloud Drive"</p>
                <p><strong>To Import:</strong> Tap Import, then select your backup file from Files</p>
            </div>
        </div>

        <!-- SCREEN 10: Cloud Sync -->
        <div id="cloudSyncScreen" class="screen">
            <h1>â˜ï¸ Cloud Sync</h1>

            <!-- Sync Status Section -->
            <div class="sync-section">
                <h3>Sync Status</h3>
                <div id="cloudSyncStatusDisplay" class="cloud-sync-status">
                    <div class="status-indicator">
                        <span class="sync-icon-large" id="syncIconLarge">â³</span>
                        <span class="sync-status-text" id="syncStatusText">Initializing...</span>
                    </div>
                    <div class="sync-details">
                        <div class="sync-detail-item">
                            <span class="detail-label">Last Sync:</span>
                            <span class="detail-value" id="lastSyncDisplay">Never</span>
                        </div>
                        <div class="sync-detail-item">
                            <span class="detail-label">Cloud Rounds:</span>
                            <span class="detail-value" id="cloudRoundsCount">0</span>
                        </div>
                        <div class="sync-detail-item">
                            <span class="detail-label">User ID:</span>
                            <span class="detail-value" id="userIdDisplay">Not authenticated</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sync Actions -->
            <div class="sync-actions-section">
                <h3>Actions</h3>
                <button class="btn-primary" id="syncNowBtn" style="width: 100%; margin-bottom: 12px;">
                    ğŸ”„ Sync Now
                </button>
                <button class="btn-secondary" id="migrateLocalDataBtn" style="width: 100%; margin-bottom: 12px;">
                    â¬†ï¸ Upload Local Data to Cloud
                </button>
                <button class="btn-secondary" id="downloadCloudDataBtn" style="width: 100%; margin-bottom: 12px;">
                    â¬‡ï¸ Download from Cloud
                </button>
            </div>

            <!-- Account Section -->
            <div class="account-section">
                <h3>Account</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 16px;">
                    You're signed in anonymously. Your data syncs across devices using a secure anonymous ID.
                </p>
                <button class="btn-secondary" id="resetAccountBtn" style="width: 100%;">
                    ğŸ”„ Reset Account (Sign Out)
                </button>
                <p style="font-size: 12px; color: #999; margin-top: 8px;">
                    Warning: Resetting creates a new account. Save backups first!
                </p>
            </div>

            <!-- Instructions -->
            <div class="sync-instructions">
                <h4>â„¹ï¸ How Cloud Sync Works</h4>
                <p><strong>âœ… Automatic:</strong> Your rounds sync automatically when you save them</p>
                <p><strong>ğŸ”’ Secure:</strong> Each device gets a unique anonymous ID - only you can access your data</p>
                <p><strong>ğŸŒ Cross-device:</strong> Access your rounds from any device (if using same browser profile)</p>
                <p><strong>âš ï¸ Offline:</strong> If offline, data saves locally and syncs when back online</p>
            </div>
        </div>

    </div>

    <script src="app.js"></script>
</body>
</html>
